---
import { Moon, Sun } from 'lucide-react';
import { Button } from './ui/button';
---

<Button variant="ghost" size="icon" id="themeToggle">
  <svg class="size-5.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <Sun
      className="rotate-0 opacity-100 transition-all duration-300 dark:rotate-90 dark:opacity-0"
    />
    <Moon
      className="rotate-90 opacity-0 transition-all duration-300 dark:rotate-0 dark:opacity-100"
    />
  </svg>
</Button>

<script is:inline>
  const theme = (() => {
    const localStorageTheme = localStorage?.getItem('theme') ?? '';
    if (['dark', 'light'].includes(localStorageTheme)) {
      return localStorageTheme;
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  })();

  if (theme === 'light') {
    document.documentElement.classList.remove('dark');
  } else {
    document.documentElement.classList.add('dark');
  }

  window.localStorage.setItem('theme', theme);

  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle('dark');

    const isDark = element.classList.contains('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  };

  document
    .getElementById('themeToggle')
    ?.addEventListener('click', handleToggleClick);
</script>
